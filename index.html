<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
  <title>Document</title>
</head>
<script>
  AFRAME.registerComponent('handle-events', {
    init: function () {
      var el = this.el;  // <a-box>
      el.addEventListener('mouseenter', function () {// accion que se ejecuta una vez el punto de mira se pone en el objeto
        //el.setAttribute('color', '#24CAFF');
        el.setAttribute('scale', { x: 1.2, y: 1.2 });
      });
      el.addEventListener('mouseleave', function () {//funcion que se ejecuta cuando el cursor deja de tocar el objeto, en este caso es para volver al color original
        el.setAttribute('scale', { x: 1, y: 1 });
        //el.setAttribute('scale', { x: document.getElementById("bb").getAttribute("scale").x * 2, y: 1, z: 2 });
      });
    }
  });

  AFRAME.registerComponent('displaytext', {
    init: function () {
      var obj = this.el;
      var texto = obj.getAttribute("name");
      var camara = document.querySelector("#paneltext")

      obj.addEventListener('mouseenter', function () {
        
        camara.setAttribute('visible', "true");
        camara.setAttribute('text', "value: "+texto);
      });
      obj.addEventListener('mouseleave', function () {
        camara.setAttribute('visible', "false");
        
      });
    }
  });

  AFRAME.registerComponent('transportando', {//funcion que teletransporta a un cubo determinado
    init: function () {
      var el2 = this.el;
      var camara = document.querySelector("#control");// selecciono la camara

      el2.addEventListener('click', function () {// esta funcion va a ubicar la camara en uno de los dos cubos amarillos que hay en el escenario
        camara.setAttribute("position", {//para modificar el atributo position de camera
          x: el2.getAttribute("position").x,// extraigo la position x del cubo que estoy haciendo click y uso esa coordenada para teletransportarme
          y: el2.getAttribute("position").y,// extraigo la position y del cubo que estoy haciendo click y uso esa coordenada para teletransportarme
          z: el2.getAttribute("position").z,// extraigo la position z del cubo que estoy haciendo click y uso esa coordenada para teletransportarme

        })
      })
    }
  })

  AFRAME.registerComponent('setinitial', {
    init: function () {
      var el2 = this.el;
      var camara = document.querySelector("#control");// selecciono la camara

      el2.addEventListener('click', function () {
        camara.setAttribute("position", {
          x: 0,
          y: 0,
          z: 1.8,

        })
      })
    }
  })

  AFRAME.registerComponent('windowanim',{
   init:function(){
    var view = this.el
     view.addEventListener('click',function(){
       
       var roty = view.getAttribute("rotation").y
         if(view.getAttribute("rotation").x==0){
          view.setAttribute('animation', 'property: rotation; to: -110 '+roty+' 0')
         }else if(view.getAttribute("rotation").x== -110){
          view.setAttribute('animation', 'property: rotation; to: 0 '+roty+' 0')
         }
         
     });
  }
});

</script>

<body style='margin : 0px; overflow: hidden;'>
  <a-scene>

    <a-assets crossOrigin="anonymous" id="manejo">
      <a-asset-item id="habitacion" src="./Modelos/world/world3.glb" position="0 0 0"></a-asset-item>
      <a-asset-item id="puertasingle" src="./Modelos/world/puerta_single.glb"></a-asset-item>
      <a-asset-item id="puertaizq" src="./Modelos/world/puerta_doble_izquierda.glb"></a-asset-item>
      <a-asset-item id="puertader" src="./Modelos/world/puerta_doble_derecha.glb"></a-asset-item>

      <a-asset-item id="estructura" src="./Modelos/maquina/estructura.glb"></a-asset-item>
      <a-asset-item id="tolba" src="./Modelos/maquina/tolba_superior.glb"></a-asset-item>
      <a-asset-item id="dosificadora" src="./Modelos/maquina/estacion_dosificadora.glb"></a-asset-item>
      <a-asset-item id="torreta" src="./Modelos/maquina/torreta.glb"></a-asset-item>
      <a-asset-item id="guiapunzones" src="./Modelos/maquina/punzones.glb"></a-asset-item>
      <a-asset-item id="tapatorreta" src="./Modelos/maquina/tapa_torreta.glb"></a-asset-item>
      <a-asset-item id="descarga" src="./Modelos/maquina/estacion_descarga.glb"></a-asset-item>
      <a-asset-item id="tapalateral" src="./Modelos/maquina/tapa_lateral.glb"></a-asset-item>
      <a-asset-item id="laminas" src="./Modelos/maquina/laminas.glb"></a-asset-item>

      <a-asset-item id="ventana" src="./Modelos/maquina/ventana.glb"></a-asset-item>
      <a-asset-item id="ventanaizq" src="./Modelos/maquina/ventana_izq.glb"></a-asset-item>

      <a-asset-item id="consola" src="./Modelos/consola/consola.glb"></a-asset-item>

      <a-asset-item id="mesa" src="./Modelos/objetos/mesa.glb"></a-asset-item>
      <a-asset-item id="estiba" src="./Modelos/objetos/estiba.glb"></a-asset-item>
      <a-asset-item id="barrilplastic" src="./Modelos/objetos/barril_plastic.glb"></a-asset-item>
      <a-asset-item id="barrilmetal" src="./Modelos/objetos/barril_metal.glb"></a-asset-item>
      <a-asset-item id="armario" src="./Modelos/objetos/armario.glb"></a-asset-item>
      <!--<a-asset-item id="arboltext" src="./principal_corregido.mtl"></a-asset-item>-->
      
      

    </a-assets>


    <a-box id="bb" color="#EF2D5E" position="0 1 -4" handle-events></a-box> <!--AquÃ­ estoy creando el cubo 1 y este va a reaccionar a la funcion handle-events-->
    <a-box class="link" id="position3" color="yellow" position="1.8 0 0" scale="0.5 0.1 0.5" transportando name="Ir..." displaytext></a-box> <!--Creo el cubo le doy una posicion y va a reaccionar a la funcion transportando-->
    <a-box class="link" id="position2" color="yellow" position="-1.8 0 0" scale="0.5 0.1 0.5" transportando name="Ir..." displaytext></a-box> <!--Creo el cubo le doy una posicion y va a reaccionar a la funcion transportando-->
    <a-box class="link" id="position1" color="yellow" position="0 0 1.8" scale="0.5 0.1 0.5" transportando name="Ir..."></a-box>
    <a-box class="link" id="position4" color="yellow" position="0 0 -1.8" scale="0.5 0.1 0.5" transportando name="Ir..." displaytext></a-box>

    <a-entity geometry="primitive: plane; height: 0.4; width: 0.8"
      material="shader: flat; src: ./Modelos/inicio.png"
      rotation="0 0 0" 
      position="-1.978 1.733 3.119"
      setinitial
      handle-events></a-entity>
    </a-entity>
    

    <a-entity>
      <a-entity gltf-model="#puertasingle" scale=".001 .001 .001" position="2.654 0 5.177" crossOrigin="anonymous"></a-entity>
      <a-entity gltf-model="#habitacion" scale=".001 .001 .001"  crossOrigin="anonymous"></a-entity>
      <a-entity gltf-model="#puertaizq" scale=".001 .001 .001" position="-1.150 0 3.006"  crossOrigin="anonymous"></a-entity>
      <a-entity gltf-model="#puertader" scale="0.001 0.001 0.001" position="0.748 0 3.006" crossorigin="anonymous"></a-entity>
      <a-entity geometry="primitive: plane; height: 1; width: 1"
      material="shader: flat; src: ./Modelos/world/logo_300_300.png"
      rotation="0 -90 0" 
      position="2.97 1.757 4.13968"></a-entity>
    </a-entity>

    <a-entity>
      <a-entity gltf-model="#estructura" scale=".001 .001 .001" position="0 0 0" crossOrigin="anonymous"></a-entity>
      <a-entity gltf-model="#tolba" scale=".001 .001 .001" position="-0.017 2.03753 0.34956" crossOrigin="anonymous" name="Tolva" displaytext></a-entity>
      <a-entity gltf-model="#dosificadora" scale=".001 .001 .001" position="0.005 0.902 0.224" crossOrigin="anonymous" name="Dosificadora" displaytext></a-entity>
      <a-entity gltf-model="#torreta" scale=".001 .001 .001" position="0 0 0" crossOrigin="anonymous"></a-entity>
      <a-entity gltf-model="#guiapunzones" scale=".001 .001 .001" position="0 0 0" crossOrigin="anonymous"></a-entity>
      <a-entity gltf-model="#tapatorreta" scale=".001 .001 .001" position="0 0 0" crossOrigin="anonymous"></a-entity>
      <a-entity gltf-model="#descarga" scale=".001 .001 .001" position="0 1.311 0" rotation="0 -122.62 0" crossOrigin="anonymous" name="Descarga" displaytext></a-entity>
      <a-entity gltf-model="#tapalateral" scale="0.001 0.001 0.001" position="0 0 0.58302" crossorigin="anonymous"></a-entity>
      <a-entity gltf-model="#tapalateral" scale="0.001 0.001 0.001" position="0 0 -0.58411" crossorigin="anonymous" rotation="0 180 0"></a-entity>
      <a-entity gltf-model="#tapalateral" scale="0.001 0.001 0.001" position="0.5824 0 0.001" crossorigin="anonymous" rotation="0 90 0"></a-entity>
      <a-entity gltf-model="#tapalateral" scale="0.001 0.001 0.001" position="-0.58696 0 0.001" crossorigin="anonymous" rotation="0 -90 0"></a-entity>
      <a-entity gltf-model="#laminas" scale=".001 .001 .001" position="0 0 0" crossOrigin="anonymous"></a-entity>
  
      <a-entity animation-mixer id="prueba1" gltf-model="#ventana" scale="0.001 0.001 0.001" position="0 1.86346 0.58942" crossorigin="anonymous" windowanim
      name="Ventana" displaytext>
        
       
      </a-entity>
      <a-entity gltf-model="#ventana" scale="0.001 0.001 0.001" position="0 1.86346 -0.58979" crossorigin="anonymous" rotation="0 180 0" windowanim name="Ventana" displaytext></a-entity>
      <a-entity gltf-model="#ventana" scale="0.001 0.001 0.001" position="0.58992 1.86346 0" crossorigin="anonymous" rotation="0 90 0" windowanim name="Ventana" displaytext></a-entity>
      <a-entity gltf-model="#ventanaizq" scale="0.001 0.001 0.001" position="-0.58992 1.86346 0" crossorigin="anonymous" rotation="0 -90 0" windowanim name="Ventana" displaytext></a-entity>
    </a-entity>

    <a-entity gltf-model="#consola" scale=".001 .001 .001" position="-1.301 0 1.517" rotation="0 81 0" crossOrigin="anonymous"></a-entity>
    <a-entity geometry="primitive: plane; height: 0.42; width: 0.42"
        material="shader: flat; src: ./Modelos/consola/img_console.jpg"
        rotation="-20.97 81 0" 
        position="-1.118 1.392 1.549"
        name = "Consola de operaci-n"
        displaytext>
    </a-entity>

    <a-entity gltf-model="#mesa" scale=".001 .001 .001" position="-2.562 0 -2.170" rotation="0 90 0"  crossOrigin="anonymous"></a-entity>
    <a-entity gltf-model="#estiba" scale=".001 .001 .001" position="2.310 0 2.334" rotation="0 0 0"  crossOrigin="anonymous"></a-entity>  
    <a-entity gltf-model="#barrilplastic" scale=".0012 .0012 .0012" position="2.310 0.2 2.334"  crossOrigin="anonymous"></a-entity> 
    <a-entity gltf-model="#barrilplastic" scale=".0012 .0012 .0012" position="2.299 0.947 2.358"  crossOrigin="anonymous"></a-entity>
    <a-entity gltf-model="#barrilmetal" scale=".001 .001 .001" position="2.486 0 1.286"  crossOrigin="anonymous"></a-entity>
    <a-entity gltf-model="#armario" scale=".001 .001 .001" position="1.721 0 -2.526"  crossOrigin="anonymous"></a-entity>

    <a-entity id="control" position="-1.368 0 4.444" rotation="0 -90 0">
      <a-camera>
        <a-cursor 
          position="0 0 -0.8"
          >
          
        </a-cursor>
        
        <a-entity id="paneltext" text="value: ; align: center; color: #000000; height: 1; width: 0.8" position="0 0.05 -0.8" visible="false"></a-entity>
      </a-camera> <!--Le paso a la camara el cursor-->
    </a-entity>
    
    <a-sky color="#333"></a-sky> <!--Creando un cielo-->
    <a-plane color="#000" rotation="-90 0 0" width="500" height="500"></a-plane> <!--Creando el plano-->

  </a-scene>


</body>

<!--
          animation__mouseenter="property: geometry.thetaLength; dir: alternate; dur: 2000;
            easing: easeInSine; from:0;to: 360;startEvents:fusing;pauseEvents:stopFuse;autoplay:false"

          animation__mouseleave="property: geometry.thetaLength; dir: alternate; dur: 500;
            easing: easeInSine; to: 0;startEvents:stopFuse;autoplay:false"

            animation__fusing="property: fusing; startEvents: fusing; easing: easeInCubic; dur: 1500; from: 1 1 1; to: 0.1 0.1 0.1"
          raycaster="objects: .link"
-->

</html>