<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
  <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
  <script>window.AFK || document.write('<script src="dist/aframe-keyboard.min.js">\x3C/script>')</script>
  <title>Demo</title>
</head>
<script src="./scripts/events.js"></script>

<body style='margin : 0px; overflow: hidden;'>

 <!--  <div style="width: 100%;height: 100%;position: absolute;z-index: 1; background-color: white;
   display: flex;justify-content: center;align-items: center; flex-direction: column;">
    
      <h1>Experiencia VR</h1>
      <button>Iniciar</button>
    
  </div> -->


  <a-scene>

    <a-assets crossOrigin="anonymous" id="manejo">
      <a-asset-item id="habitacion" src="./Modelos/world/world3.glb" position="0 0 0"></a-asset-item>
      <a-asset-item id="puertasingle" src="./Modelos/world/puerta_single.glb"></a-asset-item>
      <a-asset-item id="puertaizq" src="./Modelos/world/puerta_doble_izquierda.glb"></a-asset-item>
      <a-asset-item id="puertader" src="./Modelos/world/puerta_doble_derecha.glb"></a-asset-item>

      <a-asset-item id="estructura" src="./Modelos/maquina/estructura.glb"></a-asset-item>
      <a-asset-item id="tolba" src="./Modelos/maquina/tolba_superior.glb"></a-asset-item>
      <a-asset-item id="dosificadora" src="./Modelos/maquina/estacion_dosificadora.glb"></a-asset-item>
      <a-asset-item id="torreta" src="./Modelos/maquina/torreta.glb"></a-asset-item>
      <a-asset-item id="guiapunzones" src="./Modelos/maquina/punzones.glb"></a-asset-item>
      <a-asset-item id="tapatorreta" src="./Modelos/maquina/tapa_torreta.glb"></a-asset-item>
      <a-asset-item id="descarga" src="./Modelos/maquina/estacion_descarga.glb"></a-asset-item>
      <a-asset-item id="tapalateral" src="./Modelos/maquina/tapa_lateral.glb"></a-asset-item>
      <a-asset-item id="laminas" src="./Modelos/maquina/laminas.glb"></a-asset-item>

      <a-asset-item id="ventana" src="./Modelos/maquina/ventana.glb"></a-asset-item>
      <a-asset-item id="ventanaizq" src="./Modelos/maquina/ventana_izq.glb"></a-asset-item>

      <a-asset-item id="consola" src="./Modelos/consola/consola.glb"></a-asset-item>

      <a-asset-item id="mesa" src="./Modelos/objetos/mesa.glb"></a-asset-item>
      <a-asset-item id="estiba" src="./Modelos/objetos/estiba.glb"></a-asset-item>
      <a-asset-item id="barrilplastic" src="./Modelos/objetos/barril_plastic.glb"></a-asset-item>
      <a-asset-item id="barrilmetal" src="./Modelos/objetos/barril_metal.glb"></a-asset-item>
      <a-asset-item id="armario" src="./Modelos/objetos/armario.glb"></a-asset-item>
      <!--<a-asset-item id="arboltext" src="./principal_corregido.mtl"></a-asset-item>-->

      <audio id="alarm" src="./sound/alarm.mp3" preload="auto"></audio>
      <audio id="machine" src="./sound/machine.mp3" preload="auto"></audio>

    </a-assets>


    <a-box id="bb" color="#EF2D5E" position="0 1 -4" handle-events></a-box>
    <!--Aquí estoy creando el cubo 1 y este va a reaccionar a la funcion handle-events-->
    <a-box class="link collidable" id="position3" color="yellow" position="1.8 0 0" scale="0.5 0.1 0.5" transportando name="Ir..."
      displaytext></a-box>
    <!--Creo el cubo le doy una posicion y va a reaccionar a la funcion transportando-->
    <a-box class="link collidable" id="position2" color="yellow" position="-1.8 0 0" scale="0.5 0.1 0.5" transportando name="Ir..."
      displaytext></a-box>
    <!--Creo el cubo le doy una posicion y va a reaccionar a la funcion transportando-->
    <a-box class="link collidable" id="position1" color="yellow" position="0 0 1.8" scale="0.5 0.1 0.5" transportando name="Ir...">
    </a-box>
    <a-box class="link collidable" id="position4" color="yellow" position="0 0 -1.8" scale="0.5 0.1 0.5" transportando name="Ir..."
      displaytext></a-box>

    <a-entity class ="collidable" geometry="primitive: plane; height: 0.4; width: 0.8" material="shader: flat; src: ./Modelos/inicio.png"
      rotation="0 0 0" position="-1.978 1.733 3.119" setinitial handle-events></a-entity>
    </a-entity>


    <a-entity>
      <a-entity gltf-model="#puertasingle" scale=".001 .001 .001" position="2.654 0 5.177" crossOrigin="anonymous">
      </a-entity>
      <a-entity gltf-model="#habitacion" scale=".001 .001 .001" crossOrigin="anonymous"></a-entity>
      <a-entity gltf-model="#puertaizq" scale=".001 .001 .001" position="-1.150 0 3.006" crossOrigin="anonymous">
      </a-entity>
      <a-entity gltf-model="#puertader" scale="0.001 0.001 0.001" position="0.748 0 3.006" crossorigin="anonymous">
      </a-entity>
      <a-entity geometry="primitive: plane; height: 1; width: 1"
        material="shader: flat; src: ./Modelos/world/logo_300_300.png" rotation="0 -90 0" position="2.97 1.757 4.13968">
      </a-entity>
    </a-entity>

    <a-entity>
      <a-entity gltf-model="#estructura" scale=".001 .001 .001" position="0 0 0" crossOrigin="anonymous"></a-entity>
      <a-entity class ="collidable" gltf-model="#tolba" scale=".001 .001 .001" position="-0.017 2.03753 0.34956" crossOrigin="anonymous"
        name="Tolva" displaytext></a-entity>
      <a-entity class ="collidable" gltf-model="#dosificadora" scale=".001 .001 .001" position="0.005 0.902 0.224" crossOrigin="anonymous"
        name="Dosificadora" displaytext></a-entity>
      <a-entity gltf-model="#torreta" scale=".001 .001 .001" position="0 0 0" crossOrigin="anonymous"></a-entity>
      <a-entity gltf-model="#guiapunzones" scale=".001 .001 .001" position="0 0 0" crossOrigin="anonymous"></a-entity>
      <a-entity gltf-model="#tapatorreta" scale=".001 .001 .001" position="0 0 0" crossOrigin="anonymous"></a-entity>
      <a-entity class ="collidable" gltf-model="#descarga" scale=".001 .001 .001" position="0 1.311 0" rotation="0 -122.62 0"
        crossOrigin="anonymous" name="Descarga" displaytext></a-entity>
      <a-entity gltf-model="#tapalateral" scale="0.001 0.001 0.001" position="0 0 0.58302" crossorigin="anonymous">
      </a-entity>
      <a-entity gltf-model="#tapalateral" scale="0.001 0.001 0.001" position="0 0 -0.58411" crossorigin="anonymous"
        rotation="0 180 0"></a-entity>
      <a-entity gltf-model="#tapalateral" scale="0.001 0.001 0.001" position="0.5824 0 0.001" crossorigin="anonymous"
        rotation="0 90 0"></a-entity>
      <a-entity gltf-model="#tapalateral" scale="0.001 0.001 0.001" position="-0.58696 0 0.001" crossorigin="anonymous"
        rotation="0 -90 0"></a-entity>
      <a-entity gltf-model="#laminas" scale=".001 .001 .001" position="0 0 0" crossOrigin="anonymous"></a-entity>

      <a-entity class ="collidable" animation-mixer id="prueba1" gltf-model="#ventana" scale="0.001 0.001 0.001"
        position="0 1.86346 0.58942" crossorigin="anonymous" windowanim name="Ventana" displaytext>


      </a-entity>
      <a-entity class ="collidable" gltf-model="#ventana" scale="0.001 0.001 0.001" position="0 1.86346 -0.58979" crossorigin="anonymous"
        rotation="0 180 0" windowanim name="Ventana" displaytext></a-entity>
      <a-entity class ="collidable" gltf-model="#ventana" scale="0.001 0.001 0.001" position="0.58992 1.86346 0" crossorigin="anonymous"
        rotation="0 90 0" windowanim name="Ventana" displaytext></a-entity>
      <a-entity class ="collidable" gltf-model="#ventanaizq" scale="0.001 0.001 0.001" position="-0.58992 1.86346 0" crossorigin="anonymous"
        rotation="0 -90 0" windowanim name="Ventana" displaytext></a-entity>
    </a-entity>

    <a-entity gltf-model="#consola" scale=".001 .001 .001" position="-1.301 0 1.517" rotation="0 81 0"
      crossOrigin="anonymous"></a-entity>
    <a-entity class ="collidable" geometry="primitive: plane; height: 0.42; width: 0.42"
      material="shader: flat; src: ./Modelos/consola/img_console.jpg" rotation="-20.97 81 0"
      position="-1.118 1.392 1.549" name="Consola de operaci-n" openpanel>
    </a-entity>

    <a-entity gltf-model="#mesa" scale=".001 .001 .001" position="-2.562 0 -2.170" rotation="0 90 0"
      crossOrigin="anonymous"></a-entity>
    <a-entity gltf-model="#estiba" scale=".001 .001 .001" position="2.310 0 2.334" rotation="0 0 0"
      crossOrigin="anonymous"></a-entity>
    <a-entity gltf-model="#barrilplastic" scale=".0012 .0012 .0012" position="2.310 0.2 2.334" crossOrigin="anonymous">
    </a-entity>
    <a-entity gltf-model="#barrilplastic" scale=".0012 .0012 .0012" position="2.299 0.947 2.358"
      crossOrigin="anonymous"></a-entity>
    <a-entity gltf-model="#barrilmetal" scale=".001 .001 .001" position="2.486 0 1.286" crossOrigin="anonymous">
    </a-entity>
    <a-entity gltf-model="#armario" scale=".001 .001 .001" position="1.721 0 -2.526" crossOrigin="anonymous"></a-entity>

    <a-entity id="control" position="-1.368 0 4.444" rotation="0 -90 0">
      <a-camera>
        <a-cursor raycaster="objects: .collidable; far:2.2" id="mouseCursor" position="0 0 -0.8" 
        animation__click="property: scale; startEvents: click; easing: easeInCubic; dur: 150; from: 0.1 0.1 0.1; to: 1 1 1"
        animation__fusing="property: scale; startEvents: fusing; easing: easeInCubic; dur: 1500; from: 1 1 1; to: 0.1 0.1 0.1"
        animation__mouseleave="property: scale; startEvents: mouseleave; easing: easeInCubic; dur: 500; to: 1 1 1"
        >

        </a-cursor>

        <a-entity id="paneltext" text="value: ; align: center; color: #000000; height: 1; width: 0.8"
          position="0 0.05 -0.8" visible="false"></a-entity>
      </a-camera>
      <!--Le paso a la camara el cursor-->
    </a-entity>

    <a-sky color="#333"></a-sky>
    <!--Creando un cielo-->
    <a-plane color="#000" rotation="-90 0 0" width="500" height="500"></a-plane>
    <!--Creando el plano-->


    <!-- Setup iluminación -->
    <a-entity light="type: ambient; color: #BBB"></a-entity>
    <a-entity light="type: directional; color: #FFF; intensity: 0.6; castShadow:true" position="-0.5 2.8 1.2">
    </a-entity>

    <a-entity id="emergencylight" light="type: point; intensity: 0; distance: 50; decay: 2; color:#ff0000"
          position="0.123 2.041 0.651"></a-entity>


    <!-- Sonidos -->

    <a-entity id="soundmachine" sound=""></a-entity>


    <!--**************************************************************************************************************  -->


    <a-entity id="controlPanel" geometry="primitive: plane; width: 1.4; height: 1.0" rotation="-12 82 0"
      position="-0.99585 1.36378 1.70958" scale="0 0 0" material="shader: standard; color: white; transparent:true">
      <a-text id="input" font-family="Roboto" color="#000" value="Ingrese un comando.." scale="0.2 0.2 0.2"
        position="-0.49944 0.20156 0.01582"></a-text>
      <a-entity id="keyboard" position="-0.478 0.027 0.030" scale="2 2 2" a-keyboard>
      </a-entity>

      <a-entity geometry="primitive: plane; width: 1.4; height: 0.2" position="0 0.4 0.001" scale="" material="shader: flat; color: white;">
        <a-text id="instructions" font-family="Roboto" width="7.0" wrapcount="60.0" color="#000" value="Digite el comando 'in' y luego presione la tecla 'submit',
        en caso de emergencia presione el botón rojo" position="-0.7 0 0" scale="0.2 0.2 0.2" text="wrapCount: 60"></a-text>
      </a-entity>
      <a-cylinder class ="collidable" color="red" geometry="height: 0.04; radius: 0.06" rotation="90 0 0" position="0.483 0.136 0.001" stopemergency></a-cylinder>
    </a-entity>

    


  </a-scene>


</body>
<script>
  var input = ''
  function updateInput(e) {
    var code = parseInt(e.detail.code)
    switch (code) {
      case 8:
        input = input.slice(0, -1)
        break
      case 06:
        //alert('submitted')
        var keyboard = document.querySelector('#keyboard')
        taskActive(input)
        input=''
        document.querySelector('#input').setAttribute('value', input)
        //document.querySelector('#input').setAttribute('color', 'blue')
        //keyboard.parentNode.removeChild(keyboard)

        return
      default:
        input = input + e.detail.value
        break
    }
    document.querySelector('#input').setAttribute('value', input + '_')
  }
  document.addEventListener('a-keyboard-update', updateInput)
</script>

<!--
          animation__mouseenter="property: geometry.thetaLength; dir: alternate; dur: 2000;
            easing: easeInSine; from:0;to: 360;startEvents:fusing;pauseEvents:stopFuse;autoplay:false"

          animation__mouseleave="property: geometry.thetaLength; dir: alternate; dur: 500;
            easing: easeInSine; to: 0;startEvents:stopFuse;autoplay:false"

            animation__fusing="property: fusing; startEvents: fusing; easing: easeInCubic; dur: 1500; from: 1 1 1; to: 0.1 0.1 0.1"
          raycaster="objects: .link"
-->

</html>